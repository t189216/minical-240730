<!DOCTYPE html>
<html lang="ko" layout:decorate="~{global/userLayout}" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>작성</title>
</head>
<body>
<div layout:fragment="content">
    <script>
        function submitCreateForm(form) {
            form.title.value = form.title.value.trim();

            if (form.title.value.length == 0) {
                toastWarning('제목을 입력해주세요.');
                form.title.focus();
                return;
            }

            form.color.value = form.color.value.trim();

            if (form.color.value.length == 0) {
                toastWarning('색상을 입력해주세요.');
                form.color.focus();
                return;
            }
            
            form.submit();
        }

        function toggleRepeatFields(checkbox) {
                const repeatFields = document.getElementById('repeatFields');
                if (checkbox.checked) {
                    repeatFields.style.display = 'block';
                    updateRepeatIntervalOptions(document.getElementById('repeatType'));
                } else {
                    repeatFields.style.display = 'none';
                }
            }

            function updateRepeatIntervalOptions(select) {
                const repeatIntervalSelect = document.getElementById('repeatInterval');
                repeatIntervalSelect.innerHTML = ''; // 기존 옵션 제거

                const repeatType = select.value;
                let options = [];

                if (repeatType === 'daily') {
                    for (let i = 1; i <= 30; i++) {
                        options.push(`<option value="${i}">${i}일</option>`);
                    }
                } else if (repeatType === 'weekly') {
                    for (let i = 1; i <= 4; i++) {
                        options.push(`<option value="${i}">${i}주</option>`);
                    }
                } else if (repeatType === 'monthly') {
                    for (let i = 1; i <= 12; i++) {
                        options.push(`<option value="${i}">${i}개월</option>`);
                    }
                } else if (repeatType === 'yearly') {
                    for (let i = 1; i <= 10; i++) {
                        options.push(`<option value="${i}">${i}년</option>`);
                    }
                }

                repeatIntervalSelect.innerHTML = options.join('');
            }
    </script>

    <form th:action method="POST" onsubmit="submitCreateForm(this); return false;">
        <div>
            <label>제목</label>
            <input type="text" name="title">
        </div>
        <div>
            <label>색상</label>
            <input type="text" name="color">
        </div>

        <div>
            <label>시작 날짜</label>
            <input type="date" name="startDate">
        </div>
        <div>
            <label>시작 시간</label>
            <input type="time" name="startTime">
        </div>
        <div>
            <label>종료 날짜</label>
            <input type="date" name="endDate">
        </div>
        <div>
            <label>종료 시간</label>
            <input type="time" name="endTime">
        </div>

        <div>
            <label>반복</label>
            <input type="checkbox" name="isRepeating" onclick="toggleRepeatFields(this)">
        </div>
        <div id="repeatFields" style="display: none;">
            <label>반복 유형</label>
            <select id="repeatType" name="repeatType" onchange="updateRepeatIntervalOptions(this)">
                <option value="daily">매일</option>
                <option value="weekly">매주</option>
                <option value="monthly">매월</option>
                <option value="yearly">매년</option>
            </select>

            <label>반복 간격</label>
            <select id="repeatInterval" name="repeatInterval"></select>
        </div>

        <div>
            <label>위치</label>
            <input type="text" name="location">
        </div>
        <div>
            <label>메모</label>
            <input type="text" name="memo">
        </div>

        <button type="submit">등록</button>
    </form>
</div>
</body>
</html>